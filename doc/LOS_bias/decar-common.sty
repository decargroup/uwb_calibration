\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{decar-common}

% ====== Dependencies ======================================================= %
% Custom commands in this package need these packages

\RequirePackage{xspace}  % \xspace{} command
\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{amsthm}
\RequirePackage{mathtools}  % Extends amsmath
\RequirePackage{bm}  % Better \boldsymbol{}
\RequirePackage{accents}  % \underaccent{} command
\RequirePackage{array}  % Extends array environment
\RequirePackage{enumerate}  % Extends enumerate environment
\RequirePackage[dvipsnames]{xcolor}  % Extends default colors options
\RequirePackage{paralist}  % Provides enumerate env in paragraphs
\RequirePackage{parskip}  % Alters  \parskip{}
\RequirePackage{listings}  % Code listings

% ====== Extras ======================================================= %
% Packages commonly used in the group that aren't dependencies.

\RequirePackage{graphicx}
\RequirePackage{subcaption}
\RequirePackage{cite}
\RequirePackage[toc,page]{appendix} 
\RequirePackage{wrapfig}  % Allows figures and tables to have text around them
\RequirePackage{setspace}  % \singlespacing{}, \onehalfspacing{}, \doublespacing{}
\RequirePackage[printonlyused]{acronym}  % All acronyms are spelt out once fully
\RequirePackage{stfloats}  % Control the presentation of floats
\RequirePackage{framed}  % Create framed, shaded, or differently highlighted regions that can break across pages
\RequirePackage{multirow}  % Create tabular cells spanning multiple rows
\RequirePackage{siunitx}  % Package to properly typeset SI units, e.g. \SI{1}{\ohm}
\RequirePackage{nomencl}  % Produce lists of symbols using capabilities of MakeIndex program
\RequirePackage{placeins}  % Controls float placements by defining a \FloatBarrier command
\RequirePackage{xparse}  % Provides a high-level interface for producing document level commands.
\RequirePackage{mathrsfs}  % Raph Smith's Formal Script (\mathsrc{})
\RequirePackage{cancel}  % \cancel{}
\RequirePackage{algpseudocode}  % Algorithm layout

% ====== Custom text-mode commands ========================================== %

% Latin phrases
\newcommand{\etal}[0]{{\emph{et~al.}\@}\xspace}
% English abbreviations
\newcommand{\eg}[0]{{e.g.\@}\xspace}
\newcommand{\ie}[0]{{i.e.\@}\xspace}
\newcommand{\wrt}[0]{{w.r.t.\@}\xspace}
% Other custom commands.
% TODO I don't love these
\newcommand{\ignore}[1]{}
\newcommand{\colour}[2]{\color{#1}{#2}\color{black}\xspace} % : red, green, blue, cyan, magenta, yellow, black, gray, white, darkgray, lightgray, brown, lime, olive, orange, pink, purple, teal, violet.
\newcommand{\thline}{\begin{center} \rule{\linewidth}{0.5mm} \\ \end{center}}


% More compact enumerate and itemize environments
\newenvironment{packed_enum}{
    \begin{enumerate}
        \setlength{\itemsep}{1pt}
        \setlength{\parskip}{0pt}
        \setlength{\parsep}{0pt}
    }{\end{enumerate}}
\newenvironment{packed_itemize}{
    \begin{itemize}
        \setlength{\itemsep}{1pt}
        \setlength{\parskip}{0pt}
        \setlength{\parsep}{0pt}
    }{\end{itemize}}

% ====== Custom math-mode commands ========================================== %

% TODO Which of these styles are used? What are they used for?
% TODO With a proper setup, mbf and mbs should be the same command

% Mathcal font
\newcommand{\mc}[1]{\ensuremath{\mathcal{#1}}}
% Bold Mathcal font
\newcommand{\mbc}[1]{\ensuremath{\boldsymbol{\mathcal{#1}}}}
% Bold upright Latin alphabet in a Times font
% TODO Change to a better Times font
\DeclareMathAlphabet{\mbf}{OT1}{ptm}{b}{n}
% Bold Greek alphabet
% TODO Change to Times to match mbf
\newcommand{\mbs}[1]{\ensuremath{\boldsymbol{#1}}}
% Bold, italicized math font
% TODO Times or Computer Modern?
\newcommand{\mbm}[1]{\ensuremath{\textbf{\textit{#1}}}}
% Helpers for bold upright Latin alphabet
\newcommand{\mbfdot}[1]{\ensuremath{\dot{\mbf{#1}}}}
\newcommand{\mbfbar}[1]{\ensuremath{\bar{\mbf{#1}}}}
\newcommand{\mbfhat}[1]{\ensuremath{\hat{\mbf{#1}}}}
\newcommand{\mbfcheck}[1]{\ensuremath{\check{\mbf{#1}}}}
\newcommand{\mbfvec}[1]{\ensuremath{\underrightarrow{\mbf{#1}}}}
\newcommand{\mbfdel}[1]{\ensuremath{\delta{\mbf{#1}}}}
\newcommand{\mbftilde}[1]{\ensuremath{\tilde{\mbf{#1}}}}
% Helpers for bold Greek alphabet
\newcommand{\mbsdot}[1]{\ensuremath{\dot{\boldsymbol{#1}}}}
\newcommand{\mbsddot}[1]{\ensuremath{\ddot{\boldsymbol{#1}}}}
\newcommand{\mbsbar}[1]{\ensuremath{\bar{\boldsymbol{#1}}}}
\newcommand{\mbshat}[1]{\ensuremath{\hat{\boldsymbol{#1}}}}
\newcommand{\mbscheck}[1]{\ensuremath{\check{\boldsymbol{#1}}}}
\newcommand{\mbsvec}[1]{\ensuremath{\underrightarrow{\boldsymbol{#1}}}}
\newcommand{\mbsdel}[1]{\ensuremath{\delta{\boldsymbol{#1}}}}
\newcommand{\mbstilde}[1]{\ensuremath{\tilde{\boldsymbol{#1}}}}
% Norm
\newcommand{\norm}[1]{\ensuremath{\left\Vert#1\right\Vert}}
% Absolute value
\newcommand{\abs}[1]{\ensuremath{\left\vert#1\right\vert}}
% Inner product
\newcommand{\innerp}[2]{\left\langle #1 , #2 \right\rangle}
% Under right arrow
\newcommand{\ura}[1]{{\underrightarrow{{#1}}}}
% Mathcal L
% TODO What is this actually for? L_2 signals?
\newcommand{\mcL}[1]{\mathcal{L}\left\{#1\right\}}
% Underbar
\newcommand{\ubar}[1]{\underaccent{\bar}{#1}}
% Transpose
\newcommand{\trans}{{\ensuremath{\mathsf{T}}}}
% Hermitian transpose
\newcommand{\herm}{{\ensuremath{\mathsf{H}}}}
% Partial derivative
\newcommand{\pd}[2]{\ensuremath{\frac{\partial #1}{\partial #2}}}
% Partial
\newcommand{\p}{\partial}
% Differential t
% TODO Why does this use \mathrm{} while \dee uses \textrm{}?
\newcommand{\dt}{\mathrm{d}t}
% Differential
% TODO Why does this use \textrm{} while \dt uses \mathrm{}?
\newcommand{\dee}{\textrm{d}}
% Trace
\newcommand{\trace}{{\ensuremath{\mathrm{tr}}}}
% Rank
\newcommand{\rk}{{\ensuremath{\mathrm{rk}}}}
% Cone
\newcommand{\cone}{{\ensuremath{\mathrm{cone}}}}
% Fraction
\newcommand{\f}{\frac}
% A half
\newcommand{\onehalf}{\mbox{$\textstyle{\frac{1}{2}}$}}
% A quarter
\newcommand{\onequarter}{\mbox{$\textstyle{\frac{1}{4}}$}}
% One over two pi
\newcommand{\invtwopi}{\mbox{$\textstyle{\frac{1}{2 \pi}}$}}
% Small fraction
\newcommand{\smallf}[2]{\mbox{$\textstyle{\frac{#1}{#2}}$}}
% TODO What is this?
\newcommand{\utimes}{{\raisebox{-0.6ex}{\kern-1.0ex\raisebox{0.6ex}{\small$\mathsf{v}$}}}}
% Fourier and Laplace transforms
\newcommand{\fouriert}[1]{\texttt{F} \left\{ {#1} \right\}}
\newcommand{\invfouriert}[1]{\texttt{F}^{-1} \left\{ {#1} \right\}}
\newcommand{\laplacet}[1]{\texttt{L} \left\{ {#1} \right\}}
\newcommand{\invlaplacet}[1]{\texttt{L}^{-1} \left\{ {#1} \right\}}
% Expected value
\newcommand{\expect}[1]{\mathrm{E}[#1]}
% Variance
\newcommand{\var}[1]{\mathrm{Var}[#1]}
% Covariance
\newcommand{\cov}[1]{\mathrm{Cov}[#1]}
% Real numbers
\newcommand{\rnums}{\mathbb{R}}
% Complex numbers
\newcommand{\cnums}{\mathbb{C}}
% Identity matrix
\newcommand{\eye}{\mbf{1}}
% Inverse
\newcommand{\inv}{^{-1}}
% Frobenius norm
\newcommand{\fnorm}[1]{\norm{#1}_\mathsf{F}}
% Arg. max
\DeclareMathOperator*{\argmax}{arg\,max}
% Arg. min
\DeclareMathOperator*{\argmin}{arg\,min}
% Superscript j. 'j' has weird spacing in superscripts
\newcommand{\pj}{{\,j}}
% Double left and right angle brackets
\newcommand{\dlangle}{\langle \langle}
\newcommand{\drangle}{\rangle \rangle}

% Matrices
% TODO Is this the wrong way to make a matrix?
\newcommand{\bma}[1]{\left[\begin{array}{#1}}
\newcommand{\ema}{\end{array}\right]}
% Shortcuts for equation, displaymath, eqnarray.
% TODO None of these should be used, right? At least not eqnarray...
\newcommand{\beq}{\begin{equation}}
\newcommand{\eeq}{\end{equation}}
\newcommand{\bdis}{\begin{displaymath}}
\newcommand{\edis}{\end{displaymath}}
\newcommand{\beqarray}{\begin{eqnarray}}
\newcommand{\eeqarray}{\end{eqnarray}}
\newcommand{\beqarraynn}{\begin{eqnarray*}}
\newcommand{\eeqarraynn}{\end{eqnarray*}}

% Only load theorems and modify enums if document class is `decar-wsd`, not
% `decar-pres`.
\makeatletter
\@ifclassloaded{decar-pres} {
    % Do nothing
}{
    % Theorems
    \theoremstyle{definition} % This causes the text to be roman text
    \newtheorem{theorem}{Theorem}[section] % [section] % [chapter]
    \newtheorem{lemma}{Lemma}[section] % [section]
    \newtheorem{proposition}{Proposition}[section] % [section]
    \newtheorem{corollary}{Corollary}[section] % [section]
    \newtheorem{example}{Example}[section] % [section]
    \newtheorem{definition}{Definition}[section] % [section]
    \newtheorem{remark}{Remark}[section] % [section]
    \newtheorem{property}{Property}[section] % [section]
    \newtheorem{falgorithm}{Algorithm}[section] % [section]
    % TODO What is this for?
    \renewcommand{\theenumii}{\arabic{enumii}}
    \renewcommand{\labelenumii}{\theenumi.\theenumii.}
    \makeatletter
    \renewcommand{\p@enumii}{\theenumi.}
    \makeatother
    % \renewcommand{\labelenumi}{\arabic{enumi}.}
    % \renewcommand{\labelenumii}{\labelenumi\arabic{enumii}}
    % \renewcommand{\labelenumiii}{\labelenumii.\arabic{enumiii}}
}
\makeatother

% Computer code
\newcommand{\code}[1]{\texttt{#1}}
% Environment for printing lines of code
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
% TODO: Make this accep and optional width argument.
% See:https://tex.stackexchange.com/questions/83614/set-horizontal-width-on-custom-listings-environment
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2
}
\lstset{style=mystyle}

% ====== Commented-out garbage ============================================== %

% \usepackage{epsfig}
% \newcommand{\innerp}[3]{\left\langle #1,#2 \right\rangle_{#3}}
% \newcommand{\norm}[2]{\left| #1 \right|_{#2}}
% \newcommand{\ubar}[1]{\stackunder[1.2pt]{$#1$}{\rule{.8ex}{.075ex}}}
% \newcommand{\utimes}{{\ensuremath{\mathsf{v}}}} % 
% \newcommand{\exp}[1]{  \ensuremath{\mathrm{exp}} \left( {#1} \right) }
% \newcommand{\span}{ {\ensuremath{\mathrm{span}}} }
